Dutch Postal Address Validation System - Technical Documentation
System Overview
A production-grade Python module for validating, correcting, and searching Dutch postal addresses against official postal data files (PCS_HNR.dat, PCS_STR.dat, PCS_WPL.dat).

Architecture & Design
Core Principles
Immutability: Address objects are immutable - once created, they cannot be modified

Performance: Multi-level indexing for O(1) lookups with LRU caching

Robustness: Comprehensive error handling and input validation

Testability: Designed with dependency injection and pure functions

Maintainability: Clear separation of concerns with full type hints

System Architecture
┌─────────────────────────────────────────────────────────────┐
│                   API Layer (Optional)                      │
│  • REST endpoints (FastAPI)                                 │
│  • Input validation                                         │
│  • Response formatting                                      │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                Business Logic Layer                         │
│  • Address validation engine                                │
│  • Fuzzy matching corrector                                 │
│  • Address parser                                           │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                 Data Access Layer                           │
│  • Optimized data loader                                    │
│  • Multi-index lookup tables                                │
│  • Memory-efficient caching                                 │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                    Data Sources                             │
│  • PCS_HNR.dat - Postcode/house number mappings             │
│  • PCS_STR.dat - Street ID to name mappings                 │
│  • PCS_WPL.dat - City ID to name mappings                   │
└─────────────────────────────────────────────────────────────┘

Installation & Setup
Requirements
Python 3.11+ (Tested on 3.13, Debian Trixie)

2GB RAM minimum for full dataset

500MB disk space for data files

Quick Setup
# 1. Extract solution
tar -xzf dutch_address_solution.tar.gz
cd dutch_address

# 2. Create virtual environment
python -m venv .venv
source .venv/bin/activate  # On Windows: .venv\Scripts\activate

# 3. Install package
pip install -e .

# 4. Set up data files
mkdir data
cp /path/to/PCS_*.dat data/

# 5. Run tests
pytest

Development Dependencies

pip install pytest pytest-cov black mypy flake8

API Reference

Core Functions

validate(street_name: str, house_number: int, house_number_extension: str, postcode: str, city: str) -> bool
Validates a complete Dutch postal address against official data.

Parameters:

street_name: Name of the street

house_number: House number (positive integer)

house_number_extension: House number extension (letters, optional)

postcode: Postal code (format: '1234 AB' or '1234AB')

city: City name

Returns: True if address is valid, False otherwise

Data File Format

Expected Structure
data/
├── PCS_HNR.dat  # Postcode and house number ranges
├── PCS_STR.dat  # Street ID to name mapping
└── PCS_WPL.dat  # City ID to name mapping

Performance Characteristics
Memory Usage
Initial load: ~200MB for full dataset

Per request: < 1MB

Cache size: Configurable LRU cache (default: 10,000 entries)

Response Times
Validation: 1-5ms (cache hit), 10-50ms (cache miss)

Correction: 20-100ms (depending on dataset size)

Search: 10-50ms (indexed lookup)

Scaling Considerations
Single instance: ~1,000 requests/second

Stateless design enables horizontal scaling

Optional Redis cache for distributed environments

Input Validation Rules
Postcode: Must match pattern ^\d{4}\s?[A-Z]{2}$

House Number: Positive integer (1-99999)

Extension: Optional, letters only, max 4 characters

City/Street: Sanitized, max 100 characters

Address Lines: Exactly 2 lines, properly formatted

Graceful Degradation
Missing data files: Returns False for validation

Malformed data: Skips invalid lines with warning

Memory pressure: Automatically reduces cache size

Deployment

Dockerfile
FROM python:3.13-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .
RUN pip install -e .

USER 1000
EXPOSE 8000

CMD ["uvicorn", "dutch_address.api:app", "--host", "0.0.0.0", "--port", "8000"]

Environment Variables

# Required
DATA_DIR=/app/data

# Optional
LOG_LEVEL=INFO
CACHE_SIZE=10000
MAX_RESULTS=100
API_HOST=0.0.0.0
API_PORT=8000

Development Guide
Code Standards
Formatting: Black (line length 88)

Imports: isort (alphabetical groups)

Type Hints: Required for all public functions

Documentation: Google-style docstrings

Testing: pytest with descriptive test names

Development Workflow
Create feature branch: git checkout -b feature/validation-improvements

Write tests first: Implement tests for new functionality

Implement feature: Follow existing patterns and conventions

Run tests: pytest --cov=dutch_address --cov-report=term-missing

Code review: Ensure all tests pass and coverage remains high

Merge: Squash commits and maintain clean history

Adding New Features
Define interface: Add function signatures with type hints

Write documentation: Update this documentation file

Implement tests: Cover edge cases and error conditions

Performance testing: Benchmark against existing functionality

Update examples: Add usage examples to documentation

Security Considerations
Input Validation
All user inputs are sanitized before processing

Maximum length limits prevent DoS attacks

Regular expression validation for format checking

Data Protection
No PII stored in memory beyond request lifetime

Logs anonymized (no full addresses logged)

Data files read-only at runtime


